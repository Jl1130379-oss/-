<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå®¶å§Šå¦¹ï¼šé†«é“èˆ‡æ–‡å¿ƒ</title>
    <style>
        :root { --sci: #4FC3F7; --art: #9575CD; --dark: #263238; --win: #FFD700; }
        * { box-sizing: border-box; font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; }
        
        body { margin: 0; height: 100vh; background: #f4f7f9; display: flex; flex-direction: column; overflow: hidden; }

        /* å°è¦½åˆ— */
        header { background: var(--dark); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 100; }
        .menu-btn { background: none; border: 1px solid white; color: white; padding: 8px 15px; border-radius: 8px; cursor: pointer; }

        /* å´æ¬„é¸å–® */
        #sidebar {
            position: fixed; left: 0; top: 0; bottom: 0; width: 280px; 
            background: rgba(38, 50, 56, 0.95); backdrop-filter: blur(10px);
            transform: translateX(-100%); transition: 0.3s; z-index: 150; padding-top: 70px;
        }
        #sidebar.open { transform: translateX(0); }
        .course-item { padding: 20px; color: white; border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s; }
        .course-item:hover { background: rgba(255,255,255,0.1); }

        /* ä¸»ç•«é¢ä½ˆå±€ */
        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        
        /* è€å¸«åœ–å¼å®¹å™¨ */
        .avatar-container { position: relative; width: 260px; height: 260px; margin-bottom: 20px; }
        .avatar-img { 
            width: 100%; height: 100%; border-radius: 50%; border: 8px solid white; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); object-fit: cover; background: #eee;
            animation: breathe 4s ease-in-out infinite; display: none;
        }
        @keyframes breathe { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.02); } }

        /* å°è©±æ³¡æ³¡ */
        .bubble { 
            background: white; padding: 15px 25px; border-radius: 25px; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); width: 90%; max-width: 350px; 
            text-align: center; font-size: 1.1rem; line-height: 1.5; color: #444;
        }

        /* ç­”é¡Œå€ */
        .quiz-card { background: white; padding: 30px; border-radius: 35px; width: 100%; max-width: 450px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        .option-btn { 
            width: 100%; padding: 18px; margin: 10px 0; border: 2px solid #eee; 
            border-radius: 20px; background: white; font-size: 1.2rem; cursor: pointer; transition: 0.2s;
        }
        .option-btn:active { transform: scale(0.97); background: #fafafa; }

        /* çå‹µç‰¹æ•ˆ */
        #reward-overlay { 
            display: none; position: fixed; inset: 0; background: rgba(255,215,0,0.2); 
            z-index: 200; pointer-events: none; align-items: center; justify-content: center;
            font-size: 5rem; animation: celebrate 1s ease-out forwards;
        }
        @keyframes celebrate { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1.2); } }

        /* ç®¡ç†å“¡å…¥å£ */
        #admin-trigger { position: fixed; bottom: 0; right: 0; width: 50px; height: 50px; z-index: 99; cursor: default; }
        #admin-panel { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            z-index: 300; align-items: center; justify-content: center; color: white;
        }
        
        #loader { position: fixed; inset: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body>

<div id="loader">ğŸ“¡ æ­£åœ¨è¼‰å…¥èª²ç¨‹...</div>
<div id="reward-overlay">ğŸŒŸ</div>

<header>
    <button class="menu-btn" onclick="toggleMenu()">â˜° é¸æ“‡èª²ç¨‹</button>
    <div style="font-weight: bold;">æ±Ÿå®¶å§Šå¦¹é›²ç«¯æ•™å®¤</div>
    <div style="width: 80px;"></div>
</header>

<div id="sidebar">
    <div id="course-list"></div>
</div>

<main>
    <div id="talk-bubble" class="bubble">æ­¡è¿ä¾†åˆ°æ•™å®¤ï¼è«‹é»æ“Šé¸å–®é–‹å§‹å­¸ç¿’ã€‚</div>
    
    <div class="avatar-container">
        <img id="avatar-sci" class="avatar-img" src="IMG_3812.jpeg">
        <img id="avatar-art" class="avatar-img" src="IMG_4392.jpg">
    </div>

    <div class="quiz-card">
        <h2 id="q-text" style="margin-top:0; color:var(--dark);">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
        <div id="q-options"></div>
    </div>
</main>

<div id="admin-trigger" onclick="openAdmin()"></div>
<div id="admin-panel" onclick="this.style.display='none'">
    <div style="background:white; color:#333; padding:40px; border-radius:30px; text-align:center;">
        <h2 style="color:var(--art);">ğŸŒ¸ ç®¡ç†å“¡æ¨¡å¼ (å†¬æ«»)</h2>
        <p>ç›®å‰è³‡æ–™è®€å–è‡ª Google Sheets</p>
        <button class="option-btn" onclick="window.open('https://docs.google.com/spreadsheets/d/e/2PACX-1vTUgIoeIVP3h4C7hoHlAN7gtg_r0AYPMlX5CewmhSMCmE5faKjYD_a--Jo8u3uRmRlS2x6TzgTkvfj4/pubhtml')">é€²å…¥å¾Œå°ä¿®æ”¹é¡Œç›®</button>
    </div>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTUgIoeIVP3h4C7hoHlAN7gtg_r0AYPMlX5CewmhSMCmE5faKjYD_a--Jo8u3uRmRlS2x6TzgTkvfj4/pub?output=csv";
    let allData = [];

    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }

    async function loadSheets() {
        try {
            const res = await fetch(CSV_URL + '&t=' + Date.now());
            const text = await res.text();
            const rows = text.split("\n").map(r => r.split(","));
            allData = rows.slice(1).filter(r => r[1]); // æ’é™¤æ¨™é¡Œèˆ‡ç©ºè¡Œ
            
            const list = document.getElementById('course-list');
            list.innerHTML = "";
            allData.forEach((row, index) => {
                let div = document.createElement('div');
                div.className = "course-item";
                div.innerText = `â— ${row[1].trim()}`;
                div.onclick = () => { selectCourse(index); toggleMenu(); };
                list.appendChild(div);
            });
            document.getElementById('loader').style.display = 'none';
        } catch (e) {
            document.getElementById('loader').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–è©¦ç®—è¡¨ç™¼ä½ˆè¨­å®šã€‚";
        }
    }

    function selectCourse(idx) {
        const data = allData[idx];
        const bubble = document.getElementById('talk-bubble');
        const qText = document.getElementById('q-text');
        const optBox = document.getElementById('q-options');
        
        // åˆ‡æ›è€å¸«åœ–ç‰‡
        const isSci = data[0].trim().toLowerCase() === 'sci';
        document.getElementById('avatar-sci').style.display = isSci ? 'block' : 'none';
        document.getElementById('avatar-art').style.display = isSci ? 'none' : 'block';

        bubble.innerText = isSci ? "æˆ‘æ˜¯æ±Ÿéˆ´ï¼Œè®“æˆ‘å€‘ç”¨é†«å­¸é‚è¼¯ä¾†è§£é¡Œã€‚" : "æˆ‘æ˜¯æ±Ÿä¾ï¼Œè®“æˆ‘å€‘å¾æ–‡å­¸ä¸­å°‹æ‰¾ç­”æ¡ˆã€‚";
        qText.innerText = data[2];
        
        optBox.innerHTML = "";
        [data[3], data[4]].forEach((txt, i) => {
            let btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = txt;
            btn.onclick = () => checkAnswer(i, data[5].trim(), isSci);
            optBox.appendChild(btn);
        });
        speak(bubble.innerText + " é¡Œç›®æ˜¯ï¼š" + data[2]);
    }

    function checkAnswer(userIdx, correctIdx, isSci) {
        const bubble = document.getElementById('talk-bubble');
        if (userIdx == correctIdx) {
            bubble.innerText = "å¤ªæ£’äº†ï¼ç­”å°äº†ï¼Œç²å¾— 1 æšæ™ºæ…§é‡‘å¹£ï¼";
            showReward();
            speak("å¤ªæ£’äº†ï¼ç­”å°äº†ã€‚");
        } else {
            bubble.innerText = "å¾ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œä½†æ­£ç¢ºç­”æ¡ˆä¸æ˜¯é€™å€‹å–”ï¼Œå†è©¦è©¦çœ‹ï¼Ÿ";
            speak("å†æƒ³ä¸€ä¸‹ï¼Ÿ");
        }
    }

    function showReward() {
        const rw = document.getElementById('reward-overlay');
        rw.style.display = 'flex';
        setTimeout(() => { rw.style.display = 'none'; }, 1500);
    }

    function openAdmin() {
        if (prompt("è¼¸å…¥å†¬æ«»æš—è™Ÿï¼š") === "æ±Ÿéˆ´çš„æå‹å†¬æ«»") {
            document.getElementById('admin-panel').style.display = 'flex';
        }
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'zh-TW';
        window.speechSynthesis.speak(u);
    }

    loadSheets();
</script>
</body>
</html>
