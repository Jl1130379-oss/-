<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ±Ÿå®¶æ™ºæ…§åŸå¸‚ | ç„¡é™é€²éšç³»çµ±</title>
    <style>
        :root { --blue: #00f2fe; --pink: #ff00de; --gold: #ffd700; --bg: #010206; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'PingFang TC', sans-serif; overflow: hidden; }
        .viewport { width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        
        /* HUD é ‚éƒ¨æ•¸æ“š */
        .hud { display: flex; justify-content: space-between; padding: 20px 45px; background: rgba(0, 242, 254, 0.05); border-bottom: 2px solid var(--blue); }
        .stat { font-size: 1.2rem; font-weight: bold; text-shadow: 0 0 10px var(--blue); }

        /* å°å¸«èˆå°ï¼šåœ–ç‰‡ä¿®æ­£ç‰ˆ */
        .stage { display: flex; justify-content: center; align-items: center; gap: 80px; flex: 1; }
        .pod { text-align: center; cursor: pointer; transition: 0.5s ease; position: relative; width: 220px; }
        .avatar { 
            width: 200px; height: 200px; border-radius: 50%; border: 4px solid var(--blue);
            background-size: cover; background-position: center; box-shadow: 0 0 30px rgba(0, 242, 254, 0.3);
            margin: 0 auto;
        }
        .locked { filter: grayscale(1) brightness(0.15) contrast(0.8); opacity: 0.3; pointer-events: none; transform: scale(0.9); }

        /* å…¨æ–°é›£åº¦é¸æ“‡é¸å–® */
        .diff-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .diff-btn { padding: 10px; border: 1px solid var(--gold); background: transparent; color: var(--gold); border-radius: 10px; cursor: pointer; }
        .diff-btn:hover, .diff-btn.active { background: var(--gold); color: #000; }

        /* æ•™å­¸èˆ‡è€ƒé©—é¢æ¿ */
        .panel {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 900px; background: rgba(5, 10, 25, 0.98);
            border: 2px solid var(--gold); border-radius: 40px; padding: 35px;
            display: none; z-index: 2000; border-top: 10px solid var(--gold);
        }
        .timer { float: right; font-size: 2rem; color: var(--pink); font-family: monospace; }
        .btn { padding: 15px 40px; border-radius: 50px; border: 1px solid var(--blue); background: transparent; color: #fff; cursor: pointer; font-weight: bold; margin: 10px; }
        .btn:hover { background: var(--blue); color: #000; }
    </style>
</head>
<body>

<div class="viewport">
    <div class="hud">
        <div class="stat" style="color:var(--gold)">ğŸ® æ˜ç‡ˆ: <span id="coin-ui">0</span></div>
        <div id="status-tag">ğŸ›ï¸ å¤§å»³æš«æ­‡ - è«‹é¸æ“‡é›£åº¦èˆ‡èª²é¡Œ</div>
        <div class="stat" style="color:var(--pink)">â¤ï¸ HP: <span id="hp-ui">100</span></div>
    </div>

    <div class="stage">
        <div class="pod" id="pod-ling" onclick="selectTeacher('ling')">
            <div class="avatar" style="background-image: url('https://i.postimg.cc/mrhp4G1r/ling.png');"></div>
            <h3 style="color:var(--blue)">æ±Ÿéˆ´ (ç†ç§‘)</h3>
            <div style="font-size:0.8rem; color:var(--gold)">ğŸ‘— æµå‹•æ¥µå…‰è£™</div>
        </div>
        <div class="pod" id="pod-yi" onclick="selectTeacher('yi')">
            <div class="avatar" style="background-image: url('https://i.postimg.cc/pT3Y0yB0/yi.png'); border-color:var(--pink)"></div>
            <h3 style="color:var(--pink)">æ±Ÿä¾ (æ–‡ç§‘)</h3>
            <div style="font-size:0.8rem; color:var(--gold)">ğŸ‘˜ è½æ«»ç¹½ç´›æ¼¢æœ</div>
        </div>
    </div>

    <div class="panel" id="main-panel">
        <div id="timer-ui" class="timer"></div>
        <h2 id="panel-title" style="color:var(--gold)">èª²ç¨‹æº–å‚™ä¸­</h2>
        <div id="panel-content" style="line-height:1.8; margin-bottom: 20px;"></div>
        <div id="difficulty-selector" class="diff-menu">
            <button class="diff-btn" onclick="setDiff('åœ‹å°')">åœ‹å°</button>
            <button class="diff-btn" onclick="setDiff('åœ‹ä¸­')">åœ‹ä¸­</button>
            <button class="diff-btn" onclick="setDiff('é«˜ä¸­')">é«˜ä¸­</button>
            <button class="diff-btn" onclick="setDiff('å¤§å­¸')">å¤§å­¸</button>
            <button class="diff-btn" onclick="setDiff('ç¢©åš')">ç¢©åš</button>
        </div>
        <div id="options-area"></div>
        <div id="control-area" style="text-align:center;"></div>
    </div>

    <div style="text-align:center; padding-bottom: 40px;">
        <button id="add-course-btn" class="btn" style="border-color:var(--gold); color:var(--gold)" onclick="triggerLoad()">âš¡ è‡ªå‹•åŠ é¡Œ (é›²ç«¯ç²å–)</button>
        <button class="btn" onclick="exchange()">æ¼”åŒ–æ–°å‹•ä½œ (æ­¸é›¶)</button>
    </div>
</div>

<script>
    let state = { coin: 0, hp: 100, mode: 'idle', level: '', teacher: '', topic: null, timer: null };

    const CONFIG = {
        'åœ‹å°': { t: 180, r: 0.1, p: 2 },
        'åœ‹ä¸­': { t: 60,  r: 0.5, p: 5 },
        'é«˜ä¸­': { t: 30,  r: 1.0, p: 10 },
        'å¤§å­¸': { t: 0,   r: 2.5, p: 25 },
        'ç¢©åš': { t: 0,   r: 5.0, p: 45 }
    };

    // ç„¡é™éš¨æ©Ÿé¡Œåº«ç”Ÿæˆå™¨
    const TopicEngine = {
        subjects: ["é‡å­åŠ›å­¸", "å­˜åœ¨ä¸»ç¾©", "å®‡å®™æ¼”åŒ–", "è©©ç¶“è§£æ", "å¾®ç©åˆ†åŸç†", "å²è¨˜ç ”è®€"],
        get() {
            const s = this.subjects[Math.floor(Math.random() * this.subjects.length)];
            return { title: s, q: `é—œæ–¼${s}çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æœ€åš´è¬¹ï¼Ÿ`, a: "æ ¸å¿ƒç†è«–A", opts: ["æ ¸å¿ƒç†è«–A", "å¹²æ“¾é …B", "å¹²æ“¾é …C"] };
        }
    };

    function triggerLoad() {
        if(state.mode !== 'idle') return;
        state.topic = TopicEngine.get();
        document.getElementById('main-panel').style.display = 'block';
        document.getElementById('panel-title').innerText = `æ–°èª²é¡Œï¼š${state.topic.title}`;
        document.getElementById('panel-content').innerText = "ç¬¬ä¸€æ­¥ï¼šè«‹é»é¸ä¸‹æ–¹æŒ‰éˆ•è¨­å®šã€å­¸ç¿’é›£åº¦ã€‘ã€‚";
        document.getElementById('difficulty-selector').style.display = 'grid';
        document.getElementById('options-area').innerHTML = "";
        document.getElementById('control-area').innerHTML = "";
    }

    function setDiff(level) {
        state.level = level;
        document.getElementById('panel-content').innerText = `é›£åº¦è¨­å®šç‚ºã€${level}ã€‘ã€‚ç¬¬äºŒæ­¥ï¼šè«‹é»æ“Šä¸Šæ–¹çš„ä¸€ä½ã€è€å¸«ã€‘é–‹å§‹å°ˆæ³¨æˆèª²ã€‚`;
        document.getElementById('difficulty-selector').style.display = 'none';
    }

    function selectTeacher(t) {
        if(!state.level || state.mode !== 'idle') return;
        state.mode = 'teaching';
        state.teacher = t;

        // ã€ä¸­é€”ä¸å¯æ›èª²ã€‘é–å®šé‚è¼¯
        const other = t === 'ling' ? 'pod-yi' : 'pod-ling';
        document.getElementById(other).classList.add('locked');
        
        document.getElementById('panel-title').innerText = `å°å¸«ï¼šæ±Ÿ${t==='ling'?'éˆ´':'ä¾'} [${state.level}]`;
        document.getElementById('panel-content').innerText = `ã€æˆèª²ä¸­ã€‘${state.topic.title} åœ¨ ${state.level} éšæ®µçš„æ·±åº¦è§£æç‚ºï¼š(å°å¸«æ­£åœ¨é€éé›²ç«¯æ™ºæ…§å‚³è¼¸çŸ¥è­˜...)`;
        document.getElementById('control-area').innerHTML = `<button class="btn" onclick="startExam()">é ˜æ‚Ÿå®Œç•¢ï¼Œé–‹å§‹è€ƒé©—</button>`;
    }

    function startExam() {
        state.mode = 'exam';
        const conf = CONFIG[state.level];
        document.getElementById('panel-content').innerText = `ã€éš¨å ‚è€ƒé©—ã€‘${state.topic.q}`;
        document.getElementById('control-area').innerHTML = "";
        
        document.getElementById('options-area').innerHTML = state.topic.opts.map(o => 
            `<button class="btn" style="width:100%; text-align:left" onclick="submit('${o}')">${o}</button>`
        ).join('');

        if(conf.t > 0) {
            let s = conf.t;
            state.timer = setInterval(() => {
                s--;
                document.getElementById('timer-ui').innerText = `${s}s`;
                if(s <= 0) submit('');
            }, 1000);
        } else {
            document.getElementById('timer-ui').innerText = "âˆ ç ”è¨";
        }
    }

    function submit(ans) {
        clearInterval(state.timer);
        const conf = CONFIG[state.level];
        if(ans === state.topic.a) {
            const gain = Math.floor(1000 * conf.r);
            state.coin += gain;
            alert(`æ­£ç¢ºï¼ç²å¾— ${gain} ç›æ˜ç‡ˆã€‚`);
        } else {
            state.hp -= conf.p;
            alert(`éŒ¯èª¤ï¼æ±Ÿè€å¸«å°å¦³çš„è¡¨ç¾æ„Ÿåˆ°å ªæ†‚ï¼Œæ‰£é™¤ ${conf.p} HPã€‚`);
        }
        reset();
    }

    function reset() {
        state.mode = 'idle'; state.level = '';
        document.getElementById('main-panel').style.display = 'none';
        document.getElementById('pod-ling').classList.remove('locked');
        document.getElementById('pod-yi').classList.remove('locked');
        document.getElementById('timer-ui').innerText = "";
        updateUI();
    }

    function exchange() {
        if(state.coin <= 0) return alert("æ˜ç‡ˆä¸è¶³ä»¥ç‡ƒç‡’ï¼");
        state.coin = 0; // å…Œæ›æ­¸é›¶
        alert("æ¼”åŒ–å•Ÿå‹•ï¼æ˜ç‡ˆå·²é‡ç½®ç‚ºé›¶ï¼Œæ–°å‹•ä½œå·²è§£é–ã€‚");
        updateUI();
    }

    function updateUI() {
        document.getElementById('coin-ui').innerText = state.coin;
        document.getElementById('hp-ui').innerText = state.hp;
    }
</script>
</body>
</html>
