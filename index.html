<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå®¶å§Šå¦¹çš„å®¶ï¼šæ™ºæ…§å­¸ç¿’å…¥å£</title>
    <style>
        :root { --sci: #00E5FF; --art: #FF4081; --dark: #0F172A; --wood: #8B4513; }
        * { box-sizing: border-box; font-family: "PingFang TC", sans-serif; }
        body { margin: 0; background: #000; color: white; height: 100vh; overflow: hidden; }

        /* --- å…¥å£ï¼šæ±Ÿå®¶é–€å£ä»‹é¢ --- */
        #entrance-screen {
            position: fixed; inset: 0; background: linear-gradient(to bottom, #1e293b, #000);
            z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .house-door {
            width: 200px; height: 300px; background: var(--wood); border: 8px solid #5D2E0A;
            border-radius: 10px 10px 0 0; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5);
            cursor: pointer; transition: 0.3s;
        }
        .house-door:hover { filter: brightness(1.2); transform: scale(1.02); }
        .door-knob { position: absolute; right: 20px; top: 50%; width: 20px; height: 20px; background: gold; border-radius: 50%; }
        .welcome-sign { background: white; color: black; padding: 5px 15px; border-radius: 5px; font-weight: bold; margin-bottom: 20px; border: 2px solid #333; }

        /* --- è¨»å†Šï¼šç„é—œç™»è¨˜è¡¨ --- */
        #auth-form {
            position: absolute; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 20px;
            width: 90%; max-width: 350px; color: #333; display: none; text-align: center; box-shadow: 0 0 30px white;
        }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; }

        /* --- å…§éƒ¨ä¸»ç•«é¢ --- */
        header { padding: 10px 20px; background: #111; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; }
        .stat-box { background: #222; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; border: 1px solid #444; }
        .energy-outer { width: 60px; height: 8px; background: #333; border-radius: 4px; display: inline-block; overflow: hidden; }
        .energy-inner { height: 100%; background: #4CAF50; width: 100%; transition: 0.5s; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .char-area { position: relative; width: 220px; height: 320px; }
        .teacher-img { width: 100%; height: 100%; object-fit: contain; position: absolute; bottom: 0; transition: 0.5s; }
        #accessory-slot { position: absolute; top: 10%; width: 100%; text-align: center; font-size: 2.5rem; z-index: 10; pointer-events: none; }
        
        .bubble { background: #1E293B; border: 1px solid #334155; padding: 15px; border-radius: 20px; margin-bottom: 20px; width: 100%; max-width: 380px; text-align: center; border-left: 5px solid var(--sci); font-size: 0.9rem; }
        .quiz-card { background: white; color: #1E293B; padding: 20px; border-radius: 25px; width: 100%; max-width: 450px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .btn { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-weight: bold; font-size: 1rem; }

        nav { background: #000; display: flex; padding: 5px; border-top: 2px solid #333; }
        .nav-item { flex: 1; background: none; border: none; color: #666; padding: 12px; cursor: pointer; font-size: 0.8rem; }
        .nav-item.active { color: white; border-bottom: 3px solid var(--sci); }

        #flash-label { position: absolute; top: 15px; right: 15px; background: gold; color: #000; padding: 5px 10px; border-radius: 5px; font-weight: bold; animation: pulse 1s infinite; display: none; }
        @keyframes pulse { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="entrance-screen">
    <div class="welcome-sign">é€™è£¡æ˜¯ã€Œæ±Ÿå®¶å§Šå¦¹ã€çš„å®¶</div>
    <div class="house-door" onclick="knockDoor()">
        <div class="door-knob"></div>
    </div>
    <p style="margin-top:20px; color:#94a3b8;">è«‹é»æ“Šå¤§é–€ï¼Œæ•²æ•²é–€é€²å…¥</p>

    <div id="auth-form">
        <h2 style="margin-top:0;">ç„é—œç™»è¨˜</h2>
        <p style="font-size:0.8rem; color:#666;">åˆæ¬¡è¦‹é¢ï¼Œè«‹ç•™ä¸‹æ‚¨çš„å­¸ç¿’æª”æ¡ˆ</p>
        <input type="text" id="reg-name" placeholder="è«‹è¼¸å…¥å§“å">
        <select id="reg-age">
            <option value="12">åœ‹ä¸­ä¸€å¹´ç´š (Lv1)</option>
            <option value="13">åœ‹ä¸­äºŒå¹´ç´š (Lv2)</option>
            <option value="14">åœ‹ä¸­ä¸‰å¹´ç´š (Lv3)</option>
        </select>
        <button class="btn" style="background:var(--sci); color:white; border:none;" onclick="saveRegister()">å®Œæˆç™»è¨˜ä¸¦é€²å…¥</button>
    </div>
</div>

<header>
    <div class="stat-box">ğŸ  <span id="u-name">æœªç™»å…¥</span></div>
    <div class="stat-box">âš¡ <div class="energy-outer"><div id="e-fill" class="energy-inner"></div></div></div>
    <div class="stat-box">ğŸª™ <span id="u-coins">0</span></div>
</header>

<main>
    <div id="flash-label">âš¡ å¿«é–ƒèª²ç¨‹ä¸­ï¼</div>
    <div id="talk" class="bubble">æ­£åœ¨æº–å‚™èŒ¶é»èˆ‡èª²ç¨‹...</div>

    <div class="char-area">
        <div id="accessory-slot"></div>
        <img id="pic-sci" class="teacher-img" src="IMG_3812.jpeg">
        <img id="pic-art" class="teacher-img" src="IMG_4392.jpg" style="display:none;">
    </div>

    <div class="quiz-card">
        <h3 id="q-text">æ±Ÿè€å¸«æ­£åœ¨ç­‰å¦³ï¼Œæº–å‚™å¥½é–‹å§‹äº†å—ï¼Ÿ</h3>
        <div id="options">
            <button class="btn" onclick="startCourse()">é–‹å§‹ä»Šæ—¥èª²ç¨‹ (è€—è²» 20 âš¡)</button>
        </div>
    </div>
</main>

<nav>
    <button id="n-sci" class="nav-item active" onclick="switchT('sci')">æ±Ÿéˆ´ (ç†ç§‘)</button>
    <button id="n-art" class="nav-item" onclick="switchT('art')">æ±Ÿä¾ (æ–‡ç§‘)</button>
    <button class="nav-item" onclick="openShop()">ğŸ›ï¸ å•†åŸ/æ›è£</button>
</nav>

<script>
    // --- æ ¸å¿ƒè®Šæ•¸ ---
    let user = {
        name: "", coins: 0, energy: 100, sci_lv: 0, art_lv: 0,
        inventory: [], wearing: "", lastLogin: Date.now()
    };

    const skirtNames = {
        sci: ["å°ˆæ¥­å¯¦ç¿’é‰›ç­†è£™", "é†«ç”¨è¤¶çšºè£™", "çŸ¥æ€§é•·è£™", "æ¥µå…‰é™å®šè£™"],
        art: ["å¢¨éŸ»å‚˜è£™", "ç«¯èŠæ——è¢è£™", "æ–‡è—ç™¾è‘‰è£™", "è½æ«»é™å®šè£™"]
    };

    const hairItems = [
        { id: 'h1', name: 'ç´…çµ²å¸¶è´è¶çµ', icon: 'ğŸ€', price: 500 },
        { id: 'h2', name: 'æ™ºæ…§æ°´æ™¶å† ', icon: 'ğŸ‘‘', price: 1000 },
        { id: 'h3', name: 'æ–‡è—å°æ«»èŠ±', icon: 'ğŸŒ¸', price: 800 }
    ];

    let currentMode = 'sci';
    let isLesson = false;
    let wrongCnt = 0;
    let qIdx = 0;

    // --- å…¥å£é‚è¼¯ ---
    function knockDoor() {
        // æ’­æ”¾æ•²é–€æ•ˆæœ (è‹¥æœ‰éŸ³æ•ˆæª”å¯åŠ å…¥)
        document.querySelector('.house-door').style.transform = "scale(0.95)";
        setTimeout(() => {
            document.querySelector('.house-door').style.display = "none";
            document.getElementById('auth-form').style.display = "block";
        }, 300);
    }

    function saveRegister() {
        const n = document.getElementById('reg-name').value;
        if(!n) return alert("è«‹ç•™ä¸‹æ‚¨çš„å§“åå–”ï¼");
        user.name = n;
        save();
        enterHouse();
    }

    function enterHouse() {
        document.getElementById('entrance-screen').style.transform = "translateY(-100%)";
        updateUI();
        switchT('sci');
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function switchT(t) {
        currentMode = t;
        document.getElementById('pic-sci').style.display = (t==='sci'?'block':'none');
        document.getElementById('pic-art').style.display = (t==='art'?'block':'none');
        document.getElementById('n-sci').className = (t==='sci'?'nav-item active':'nav-item');
        document.getElementById('n-art').className = (t==='art'?'nav-item active':'nav-item');
        
        applyAutoSkirt();
        updateUI();
    }

    function applyAutoSkirt() {
        const lv = currentMode === 'sci' ? user.sci_lv : user.art_lv;
        const name = skirtNames[currentMode][Math.min(lv, 3)];
        document.getElementById('talk').innerText = `ç›®å‰ç©¿è‘—ï¼š${name}ã€‚æ­¡è¿ä¾†åˆ°æˆ‘å€‘å®¶ã€‚`;
    }

    function startCourse() {
        if(user.energy < 20) return alert("é«”åŠ›ä¸è¶³ï¼Œè«‹åˆ·è£œèƒ½é¡Œåº«æˆ–ç­‰å¾…ä¼‘æ¯ã€‚");
        sessionStorage.setItem('lesson_on', 'true');
        isLesson = true;
        qIdx = 0; wrongCnt = 0;
        loadQ();
    }

    function loadQ() {
        qIdx++;
        document.getElementById('q-text').innerText = `ã€${currentMode==='sci'?'ç†ç§‘':'æ–‡ç§‘'}ã€‘ç¬¬ ${qIdx}/10 é¡Œï¼šå…§å®¹è¼‰å…¥ä¸­...`;
        const opt = document.getElementById('options');
        opt.innerHTML = "";
        ["é¸é … A", "é¸é … B", "é¸é … C"].forEach((t, i) => {
            let b = document.createElement('button');
            b.className = "btn";
            b.innerText = t;
            b.onclick = () => {
                if(i !== 0) wrongCnt++;
                if(qIdx < 10) loadQ(); else endLesson();
            };
            opt.appendChild(b);
        });
    }

    function endLesson() {
        sessionStorage.removeItem('lesson_on');
        user.energy -= 20;
        const err = wrongCnt / 10;
        if(err <= 0.3) {
            user.coins += 200;
            if(currentMode==='sci') user.sci_lv++; else user.art_lv++;
            alert("æŒ‘æˆ°æˆåŠŸï¼ç²å–é‡‘å¹£ä¸¦æ™‰å‡è£æ‰®ã€‚");
        } else {
            alert("éŒ¯èª¤ç‡éé«˜ï¼Œé€™æ¬¡æ²’æœ‰çå‹µå–”ã€‚");
        }
        updateUI();
        applyAutoSkirt();
        document.getElementById('options').innerHTML = `<button class="btn" onclick="startCourse()">ä¸‹ä¸€å ‚èª²</button>`;
    }

    function openShop() {
        let s = "ã€é‡‘å¹£å•†åŸã€‘\næ“æœ‰çš„é‡‘å¹£: " + user.coins + "\n";
        hairItems.forEach(i => s += `${i.id}: ${i.name} (${i.price}ğŸª™)\n`);
        const choice = prompt(s + "\nè¼¸å…¥IDè³¼è²·æˆ–æ›´æ›å·²æœ‰çš„ï¼š");
        const item = hairItems.find(i => i.id === choice);
        if(item) {
            if(user.inventory.includes(choice)) {
                user.wearing = item.icon;
            } else if(user.coins >= item.price) {
                user.coins -= item.price;
                user.inventory.push(choice);
                user.wearing = item.icon;
            } else { alert("é‡‘å¹£ä¸è¶³ï¼"); }
        }
        updateUI();
        save();
    }

    function updateUI() {
        document.getElementById('u-name').innerText = user.name;
        document.getElementById('u-coins').innerText = user.coins;
        document.getElementById('e-fill').style.width = user.energy + "%";
        document.getElementById('accessory-slot').innerText = user.wearing;
    }

    function save() { localStorage.setItem('jiang_ultimate_home', JSON.stringify(user)); }

    window.onload = () => {
        const saved = localStorage.getItem('jiang_ultimate_home');
        if(saved) {
            user = JSON.parse(saved);
            // é˜²é‡æ•´æ©Ÿåˆ¶
            if(sessionStorage.getItem('lesson_on')) {
                user.energy = Math.max(0, user.energy - 10);
                alert("åµæ¸¬åˆ°é‡æ•´ï¼æ±Ÿè€å¸«ä¸å–œæ­¡æŠ•æ©Ÿå–å·§ï¼Œé«”åŠ›å·²æ‰£é™¤ã€‚");
            }
            enterHouse();
        }
    }
</script>
</body>
</html>
