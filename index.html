<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå®¶å§Šå¦¹ï¼š108 èª²ç¶±é«˜ç´šå­¸ç¿’ç³»çµ±</title>
    <style>
        :root { --sci: #00E5FF; --art: #FF4081; --dark: #020617; --gold: #FACC15; --warn: #EF4444; }
        * { box-sizing: border-box; font-family: "PingFang TC", "Noto Sans TC", sans-serif; }
        body { margin: 0; background: var(--dark); color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* é˜²å¼Šç´…è‰²è¦†è“‹å±¤ */
        #cheat-guard { position: fixed; inset: 0; background: var(--warn); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }

        /* é«˜ç´šå…¥å£ï¼šæ±Ÿå®¶å¤§é–€ */
        #entrance { position: fixed; inset: 0; background: radial-gradient(circle, #1e293b, #000); z-index: 9000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 1s ease-in-out; }
        .door { width: 180px; height: 280px; border: 6px solid #451a03; background: #78350f; border-radius: 10px; cursor: pointer; position: relative; box-shadow: 0 0 30px rgba(0,0,0,1); }
        .knob { position: absolute; right: 15px; top: 50%; width: 15px; height: 15px; background: var(--gold); border-radius: 50%; }

        /* é ‚éƒ¨å°èˆª */
        header { padding: 12px 20px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .stat-pill { background: #1e293b; padding: 6px 15px; border-radius: 20px; font-size: 0.85rem; border: 1px solid #334155; display: flex; align-items: center; gap: 8px; }
        .energy-bar { width: 50px; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .energy-fill { height: 100%; background: #22c55e; transition: 0.4s; }

        /* ä¸»ç•«é¢ */
        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .teacher-stage { position: relative; width: 250px; height: 350px; perspective: 1000px; }
        .teacher-img { width: 100%; height: 100%; object-fit: contain; position: absolute; bottom: 0; filter: drop-shadow(0 10px 20px rgba(0,229,255,0.2)); transition: 0.5s; }
        .accessory-overlay { position: absolute; top: 15%; width: 100%; text-align: center; font-size: 3rem; z-index: 20; }

        .chat-bubble { background: #1e293b; padding: 15px; border-radius: 20px; width: 95%; max-width: 450px; margin-bottom: 20px; border-left: 5px solid var(--sci); font-size: 0.95rem; line-height: 1.5; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .quiz-container { background: white; color: #0f172a; padding: 25px; border-radius: 30px; width: 100%; max-width: 500px; text-align: center; }
        .opt-btn { width: 100%; padding: 14px; margin: 8px 0; border: 2px solid #e2e8f0; border-radius: 15px; background: white; cursor: pointer; font-weight: bold; font-size: 1.05rem; transition: 0.2s; }
        .opt-btn:hover { border-color: var(--sci); background: #f0fdff; }

        /* æ§åˆ¶å° */
        nav { background: #000; display: flex; border-top: 1px solid #334155; }
        .nav-tab { flex: 1; padding: 15px; background: none; border: none; color: #64748b; font-size: 0.85rem; cursor: pointer; transition: 0.3s; }
        .nav-tab.active { color: white; border-bottom: 3px solid var(--sci); background: linear-gradient(to top, rgba(0,229,255,0.1), transparent); }
    </style>
</head>
<body>

<div id="cheat-guard">
    <h1>ğŸš« åµæ¸¬åˆ°é•è¦é›¢é–‹ï¼</h1>
    <p>æ±Ÿè€å¸«ï¼š108 èª²ç¶±é‡è¦–èª ä¿¡èˆ‡ç´ é¤Šã€‚é›¢é–‹é é¢è¦–åŒæ”¾æ£„ï¼Œæ‰£é™¤é«”åŠ› 20 é»ã€‚</p>
    <button onclick="location.reload()" style="padding:10px 30px; border-radius:10px; border:none;">é‡æ–°é–‹å§‹</button>
</div>

<div id="entrance">
    <div style="margin-bottom:30px; text-align:center;">
        <h2 style="letter-spacing:5px;">æ±Ÿå®¶å§Šå¦¹ï¼šé†«æ–‡é›™ä¿®</h2>
        <p style="color:#94a3b8;">108 èª²ç¶± AI æ™ºæ…§é«˜ç´šé›²ç«¯æ•™å®¤</p>
    </div>
    <div class="door" onclick="unlockDoor()">
        <div class="knob"></div>
    </div>
    <div id="reg-box" style="display:none; margin-top:30px; width:300px;">
        <input type="text" id="user-n" placeholder="è¼¸å…¥å­¸å“¡å§“å..." style="width:100%; padding:12px; border-radius:10px; border:none;">
        <select id="user-l" style="width:100%; padding:12px; margin-top:10px; border-radius:10px;">
            <option value="junior">åœ‹ä¸­ 108 èª²ç¶± (Lv.1-3)</option>
            <option value="senior">é«˜ä¸­ 108 èª²ç¶± (å­¸æ¸¬/æŒ‡è€ƒ)</option>
            <option value="expert">ç¢©åšå°ˆç ”/ç«¶è³½ (ä¸è¨ˆæ™‚/åš´æ ¼æ¨¡å¼)</option>
        </select>
        <button onclick="confirmEntry()" style="width:100%; padding:15px; margin-top:20px; background:var(--sci); border:none; border-radius:10px; font-weight:bold;">è¸å…¥å®¶é–€</button>
    </div>
</div>

<header>
    <div class="stat-pill"><span id="display-name">å­¸å“¡</span></div>
    <div id="timer-display" style="color:var(--sci); font-weight:bold; font-family:monospace;">â³ æº–å‚™ä¸­</div>
    <div style="display:flex; gap:10px;">
        <div class="stat-pill">âš¡ <div class="energy-bar"><div id="e-fill" class="energy-fill"></div></div></div>
        <div class="stat-pill">ğŸª™ <span id="u-coins">0</span></div>
    </div>
</header>

<main>
    <div class="chat-bubble" id="teacher-msg">æ­£åœ¨è¼‰å…¥ 108 èª²ç¶±ç´ é¤Šé¡Œåº«...</div>
    <div class="teacher-stage">
        <div id="acc-slot" class="accessory-overlay"></div>
        <img id="img-sci" class="teacher-img" src="IMG_3812.jpeg">
        <img id="img-art" class="teacher-img" src="IMG_4392.jpg" style="display:none;">
    </div>
    <div class="quiz-container">
        <h3 id="q-text" style="margin:0 0 15px 0;">é»æ“Šä¸‹æ–¹è€å¸«é–‹å§‹ä»Šæ—¥èª²ç¨‹</h3>
        <div id="options"></div>
    </div>
</main>

<nav>
    <button id="tab-sci" class="nav-tab active" onclick="switchTeacher('sci')">ğŸ’¬ æ±Ÿéˆ´ (ç†ç§‘/ç”Ÿç‰©)</button>
    <button id="tab-art" class="nav-tab" onclick="switchTeacher('art')">ğŸ’¬ æ±Ÿä¾ (æ–‡ç§‘/ç¤¾æœƒ)</button>
    <button class="nav-tab" onclick="openShop()">ğŸ›ï¸ è£æ‰®å•†åŸ</button>
</nav>

<script>
    // --- é«˜ç´šæ•´åˆè³‡æ–™åº« ---
    let state = {
        name: "", coins: 0, energy: 100, level: 'junior',
        sci_lv: 0, art_lv: 0, inventory: [], wearing: "",
        isTesting: false
    };

    const skirtConfig = {
        sci: ["å°ˆæ¥­é†«ç”¨é‰›ç­†è£™", "å¯¦é©—å®¤è¤¶çšºè£™", "çŸ¥æ€§æ•™æˆé•·è£™", "æ¥µå…‰é™å®šå¯¦é©—è£"],
        art: ["å¤å…¸å¢¨è‰²é•·è£™", "å…¸é›…æ——è¢å¼é•·è£™", "æ–‡è—ç™¾è‘‰å‚˜è£™", "è½æ«»é™å®šé•·è£™"]
    };

    // --- ç³»çµ±åŠŸèƒ½ ---
    function unlockDoor() {
        document.querySelector('.door').style.transform = "rotateY(-110deg)";
        document.querySelector('.door').style.transformOrigin = "left";
        setTimeout(() => { document.getElementById('reg-box').style.display = 'block'; }, 500);
    }

    function confirmEntry() {
        state.name = document.getElementById('user-n').value || "å„ªç­‰ç”Ÿ";
        state.level = document.getElementById('user-l').value;
        document.getElementById('entrance').style.transform = "translateY(-100%)";
        save();
        updateUI();
        switchTeacher('sci');
    }

    function switchTeacher(t) {
        state.activeTeacher = t;
        document.getElementById('img-sci').style.display = t === 'sci' ? 'block' : 'none';
        document.getElementById('img-art').style.display = t === 'art' ? 'block' : 'none';
        document.getElementById('tab-sci').className = t === 'sci' ? 'nav-tab active' : 'nav-tab';
        document.getElementById('tab-art').className = t === 'art' ? 'nav-tab active' : 'nav-tab';
        
        const lv = t === 'sci' ? state.sci_lv : state.art_lv;
        const skirt = skirtConfig[t][Math.min(lv, 3)];
        document.getElementById('teacher-msg').innerText = `æˆ‘æ˜¯${t==='sci'?'æ±Ÿéˆ´':'æ±Ÿä¾'}ã€‚ç›®å‰è‘—è£ï¼š${skirt}ã€‚æº–å‚™å¥½æŒ‘æˆ° 108 èª²ç¶±äº†å—ï¼Ÿ`;
        
        resetQuiz();
    }

    function resetQuiz() {
        document.getElementById('q-text').innerText = "é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æœ¬æ¬¡èª²ç¨‹";
        document.getElementById('options').innerHTML = `<button class="opt-btn" style="background:var(--sci); color:black;" onclick="startSession()">é–‹å§‹ 10 é¡Œç´ é¤ŠæŒ‘æˆ° (è€—è²» 20âš¡)</button>`;
    }

    // --- è‡ªå‹•æŠ“é¡Œèˆ‡è¨ˆæ™‚ç³»çµ± ---
    let timerInterval;
    function startSession() {
        if(state.energy < 20) return alert("é«”åŠ›ä¸è¶³ï¼Œè«‹åˆ·é¡Œè£œèƒ½ï¼");
        state.isTesting = true;
        sessionStorage.setItem('on_exam', 'true');
        
        let qCount = 0;
        let wrongs = 0;
        const isExpert = state.level === 'expert';
        
        function nextQ() {
            qCount++;
            if(qCount > 10) return finish(wrongs);
            
            // æ ¹æ“šç­‰ç´šè¨­å®šåˆ†é˜å€’æ•¸ (æœ€ä½ 3 åˆ†é˜)
            if(!isExpert) startTimer(state.level === 'junior' ? 3 : 5);
            else document.getElementById('timer-display').innerText = "ğŸ† ç«¶è³½ä¸è¨ˆæ™‚ (åš´ç¦é›¢é–‹)";

            document.getElementById('q-text').innerText = `(108èª²ç¶±-${state.level}) ç¬¬ ${qCount}/10 é¡Œå…§å®¹ç²å–ä¸­...`;
            document.getElementById('options').innerHTML = `
                <button class="opt-btn" onclick="check(true)">æ­£ç¢º (ç¬¦åˆç´ é¤Šå°å‘)</button>
                <button class="opt-btn" onclick="check(false)">éŒ¯èª¤ A</button>
                <button class="opt-btn" onclick="check(false)">éŒ¯èª¤ B</button>
            `;
        }

        window.check = (correct) => {
            if(!correct) wrongs++;
            nextQ();
        };

        nextQ();
    }

    function startTimer(mins) {
        clearInterval(timerInterval);
        let sec = mins * 60;
        timerInterval = setInterval(() => {
            let m = Math.floor(sec / 60);
            let s = sec % 60;
            document.getElementById('timer-display').innerText = `â³ ${m}:${s < 10 ? '0' : ''}${s}`;
            if(sec <= 0) { clearInterval(timerInterval); alert("æ™‚é–“åˆ°ï¼å¤±æ•—ã€‚"); finish(10); }
            sec--;
        }, 1000);
    }

    function finish(wrongs) {
        clearInterval(timerInterval);
        state.isTesting = false;
        sessionStorage.removeItem('on_exam');
        state.energy -= 20;
        
        if(wrongs / 10 <= 0.3) {
            state.coins += (state.level === 'expert' ? 1000 : 200);
            if(state.activeTeacher === 'sci') state.sci_lv++; else state.art_lv++;
            alert("æˆåŠŸéé—œï¼è§£é–æ–°è£™è£ä¸¦ç²å¾—é‡‘å¹£ã€‚");
        } else {
            alert("éŒ¯èª¤ç‡è¶…é 30%ï¼Œæœªèƒ½ç²å¾—çå‹µã€‚");
        }
        updateUI();
        save();
        switchTeacher(state.activeTeacher);
    }

    // --- é˜²å¼Šï¼šè·³è½‰ç›£æ¸¬ ---
    document.addEventListener("visibilitychange", () => {
        if (document.hidden && sessionStorage.getItem('on_exam')) {
            state.energy = Math.max(0, state.energy - 20);
            save();
            document.getElementById('cheat-guard').style.display = 'flex';
        }
    });

    function updateUI() {
        document.getElementById('u-coins').innerText = state.coins;
        document.getElementById('e-fill').style.width = state.energy + "%";
        document.getElementById('display-name').innerText = state.name;
        document.getElementById('acc-slot').innerText = state.wearing;
    }

    function save() { localStorage.setItem('jiang_pro_v5', JSON.stringify(state)); }

    window.onload = () => {
        const saved = localStorage.getItem('jiang_pro_v5');
        if(saved) {
            state = JSON.parse(saved);
            document.getElementById('entrance').style.display = 'none';
            updateUI();
            switchTeacher('sci');
        }
    };
</script>
</body>
</html>
