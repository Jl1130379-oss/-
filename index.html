<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±Ÿå®¶æ™ºæ…§åŸå¸‚ï¼šå§å¦¹å¤§å®…</title>
    <style>
        :root { --sci: #22d3ee; --art: #fb7185; --gold: #facc15; --snow: #f0f9ff; --glass: rgba(255,255,255,0.15); }
        * { box-sizing: border-box; font-family: "PingFang TC", sans-serif; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        body { margin: 0; background: #000; color: white; height: 100vh; overflow: hidden; }

        /* å ´æ™¯èƒŒæ™¯å±¤ */
        #main-stage { position: fixed; inset: 0; background-size: cover; background-position: center; z-index: -1; }
        .bg-yard { background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url('https://images.unsplash.com/photo-1582103287241-2762adba6c36?q=80&w=2000'); }
        .bg-room { background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.2)), url('https://images.unsplash.com/photo-1513694203232-719a280e022f?q=80&w=2000'); }

        /* UI å…ƒä»¶ */
        header { position: fixed; top: 30px; left: 30px; right: 30px; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .coin-display { background: var(--glass); backdrop-filter: blur(10px); padding: 10px 25px; border-radius: 50px; font-weight: 900; font-size: 1.5rem; border: 1px solid rgba(255,255,255,0.2); }
        
        /* å´é‚Šå°èˆªé¸å–® */
        .nav-menu { position: fixed; left: 30px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 20px; z-index: 100; }
        .nav-btn { width: 60px; height: 60px; background: var(--glass); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .nav-btn:hover { background: white; color: black; transform: scale(1.1); }

        /* è€å¸«ç«‹ç¹ª */
        .teacher-container { position: absolute; bottom: -50px; display: flex; justify-content: center; width: 100%; gap: 100px; pointer-events: none; }
        .teacher { height: 85vh; filter: drop-shadow(0 0 30px rgba(0,0,0,0.5)); pointer-events: auto; cursor: pointer; }
        .teacher:hover { transform: translateY(-20px) scale(1.05); }

        /* åº­é™¢è£é£¾ç³»çµ± */
        #yard-items { position: absolute; inset: 0; pointer-events: none; }
        .furniture { position: absolute; pointer-events: auto; transition: 0.3s; cursor: move; }

        /* å½ˆçª—ç³»çµ± */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; color: #333; padding: 40px; border-radius: 40px; width: 550px; text-align: center; max-height: 80vh; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .card { background: #f8fafc; padding: 20px; border-radius: 25px; border: 2px solid #eee; text-align: center; }
        .btn-buy { width: 100%; margin-top: 10px; padding: 10px; border-radius: 12px; border: none; background: var(--art); color: white; font-weight: bold; cursor: pointer; }

        /* å°è©±æ°£æ³¡ */
        .bubble { position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: white; color: #333; padding: 20px 40px; border-radius: 50px; font-weight: bold; display: none; z-index: 500; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        /* é›ªèŠ±ç®¡ç†è€… */
        .snow-admin { position: fixed; bottom: 30px; right: 30px; font-size: 60px; cursor: pointer; opacity: 0.3; filter: drop-shadow(0 0 10px var(--sci)); }
    </style>
</head>
<body onload="init()">

<div id="main-stage" class="bg-yard"></div>
<div id="yard-items"></div>

<header>
    <div style="font-size: 1.8rem; font-weight: 900; letter-spacing: 2px;">æ±Ÿå®¶æ™ºæ…§åŸå¸‚ <span id="location-name">åº­é™¢</span></div>
    <div class="coin-display">ğŸª™ <span id="coin-val">500</span></div>
</header>

<div class="nav-menu">
    <div class="nav-btn" onclick="switchScene('yard')" title="åº­é™¢">ğŸ¡</div>
    <div class="nav-btn" onclick="switchScene('room')" title="è€å¸«çš„å®¶">ğŸ›‹ï¸</div>
    <div class="nav-btn" onclick="openModal('shop')" title="å•†å ´">ğŸ›’</div>
    <div class="nav-btn" onclick="openModal('closet')" title="æ›´è¡£å®¤">ğŸ‘š</div>
    <div class="nav-btn" onclick="openModal('quiz')" title="ç­”é¡Œè³ºéŒ¢">ğŸ“š</div>
</div>

<div class="teacher-container">
    <img id="ling" class="teacher" src="IMG_3812.jpeg" onclick="talk('ling')">
    <img id="yi" class="teacher" src="IMG_4392.jpg" onclick="talk('yi')">
</div>

<div id="bubble" class="bubble"></div>

<div id="modal" class="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="modal-title">æ¨™é¡Œ</h2>
        <div id="modal-body" class="grid"></div>
        <button onclick="closeModal()" style="margin-top:20px; border:none; background:#eee; padding:10px 20px; border-radius:15px; cursor:pointer;">è¿”å›</button>
    </div>
</div>

<div class="snow-admin" onclick="admin()">â„ï¸</div>

<script>
    let state = { coins: 500, isAdmin: false, scene: 'yard', ownedItems: [] };

    const data = {
        shop: [
            { id: 'f1', name: 'å¤§ç†çŸ³å™´æ³‰', price: 1500, type: 'furniture', icon: 'â›²' },
            { id: 'f2', name: 'æ«»èŠ±æ¨¹', price: 800, type: 'furniture', icon: 'ğŸŒ¸' },
            { id: 'f3', name: 'éœ²å¤©èŒ¶åº§', price: 1200, type: 'furniture', icon: 'ğŸµ' }
        ],
        closet: [
            { id: 'c1', name: 'æ¥µå…‰é†«å­¸é•·è£™', price: 2000, img: 'IMG_3812.jpeg' },
            { id: 'c2', name: 'æ«»è‰²æ¼¢æœæ´‹è£', price: 2000, img: 'IMG_4392.jpg' }
        ]
    };

    function init() {
        talk('welcome');
    }

    function switchScene(s) {
        state.scene = s;
        const stage = document.getElementById('main-stage');
        const loc = document.getElementById('location-name');
        const yardItems = document.getElementById('yard-items');
        
        if(s === 'yard') {
            stage.className = 'bg-yard';
            loc.innerText = 'åº­é™¢';
            yardItems.style.display = 'block';
        } else {
            stage.className = 'bg-room';
            loc.innerText = 'æ±Ÿå®¶å®¢å»³';
            yardItems.style.display = 'none';
        }
    }

    function talk(who) {
        const b = document.getElementById('bubble');
        const msgs = {
            ling: "æ±Ÿéˆ´ï¼šé€™è£¡çš„å™´æ³‰æ˜¯å¦³è¦ªè‡ªè£é£¾çš„å—ï¼ŸçœŸæ¼‚äº®ã€‚",
            yi: "æ±Ÿä¾ï¼šå§å§ï¼Œæˆ‘å€‘å¸¶æ†¶å©·å»æ›´è¡£å®¤è©¦è©¦é‚£ä»¶æ¼¢æœå§ï¼",
            welcome: "å…©ä½è€å¸«ï¼šæ­¡è¿å›åˆ°æ±Ÿå®¶ï¼ä»Šå¤©æƒ³åšé»ä»€éº¼ï¼Ÿ"
        };
        b.innerText = msgs[who] || msgs.welcome;
        b.style.display = 'block';
        setTimeout(() => b.style.display = 'none', 3000);
    }

    function openModal(type) {
        const modal = document.getElementById('modal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        modal.style.display = 'flex';
        body.innerHTML = '';

        if(type === 'shop') {
            title.innerText = 'ğŸ›ï¸ æ±Ÿå®¶è£é£¾å•†å ´';
            data.shop.forEach(item => {
                const price = state.isAdmin ? item.price * 0.1 : item.price;
                body.innerHTML += `
                    <div class="card">
                        <div style="font-size:3rem;">${item.icon}</div>
                        <b>${item.name}</b>
                        <button class="btn-buy" onclick="buyItem('${item.id}', ${price}, 'furniture')">ğŸ’° ${price}</button>
                    </div>`;
            });
        } else if(type === 'closet') {
            title.innerText = 'ğŸ‘— è€å¸«çš„æ›´è¡£å®¤';
            data.closet.forEach(item => {
                const price = state.isAdmin ? item.price * 0.1 : item.price;
                body.innerHTML += `
                    <div class="card">
                        <img src="${item.img}" style="width:100%; border-radius:10px;">
                        <b>${item.name}</b>
                        <button class="btn-buy" onclick="buyItem('${item.id}', ${price}, 'cloth')">ğŸ’° ${price}</button>
                    </div>`;
            });
        } else if(type === 'quiz') {
            title.innerText = 'ğŸ“š éš¨å ‚æ¸¬é©— (è³ºéŒ¢)';
            body.innerHTML = `<div style="grid-column: span 2;">
                <p><b>æ±Ÿéˆ´ï¼šè«‹å•äººé«”æœ€å¤§çš„å™¨å®˜æ˜¯ï¼Ÿ</b></p>
                <button class="btn-buy" onclick="answer(true)">çš®è†š</button>
                <button class="btn-buy" onclick="answer(false)">å¿ƒè‡Ÿ</button>
            </div>`;
        }
    }

    function buyItem(id, price, type) {
        if(state.coins >= price) {
            state.coins -= price;
            updateUI();
            if(type === 'furniture') {
                const item = data.shop.find(i => i.id === id);
                addFurniture(item.icon);
                alert(`æ±Ÿä¾ï¼šé€™åº§${item.name}æ”¾åœ¨åº­é™¢ä¸€å®šå¾ˆç¾ï¼`);
            } else {
                alert("æ±Ÿéˆ´ï¼šé€™ä»¶è¡£æœå¾ˆé©åˆå¦³ï¼Œæ”¶é€²è¡£æ«ƒå§ã€‚");
            }
            closeModal();
        } else alert("é‡‘å¹£ä¸å¤ å–”ï¼å¿«å»ç­”é¡Œè³ºéŒ¢ã€‚");
    }

    function addFurniture(icon) {
        const yard = document.getElementById('yard-items');
        const div = document.createElement('div');
        div.className = 'furniture';
        div.style.fontSize = '4rem';
        div.style.left = Math.random() * 80 + '%';
        div.style.top = Math.random() * 60 + 20 + '%';
        div.innerText = icon;
        yard.appendChild(div);
    }

    function answer(correct) {
        if(correct) {
            state.coins += 200;
            updateUI();
            alert("æ±Ÿéˆ´ï¼šæ­£ç¢ºï¼é€™é»é›£ä¸å€’å¦³ã€‚çå‹µ 200 é‡‘å¹£ã€‚");
        } else alert("å†æƒ³æƒ³çœ‹å–”ã€‚");
        closeModal();
    }

    function admin() {
        if(prompt("è«‹è¼¸å…¥ç®¡ç†è€…ä»£ç¢¼ï¼š") === "æ±Ÿæ†¶å©·") {
            state.isAdmin = true;
            state.coins += 1000;
            updateUI();
            alert("ğŸ‘‘ æ­¡è¿ç®¡ç†è€…æ±Ÿæ†¶å©·ï¼\n1. ç²å¾—1000å…ƒå•Ÿå‹•é‡‘\n2. å•†å ´å…¨å ´é–‹å•Ÿ1æŠ˜ç‰¹æ¬Šï¼");
        }
    }

    function updateUI() {
        document.getElementById('coin-val').innerText = (state.isAdmin ? "â„ï¸ " : "") + state.coins;
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
</script>
</body>
</html>
