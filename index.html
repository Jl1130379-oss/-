<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ±Ÿå®¶å§Šå¦¹ï¼š108 èª²ç¶±æ™ºæ…§è€ƒå ´</title>
    <style>
        :root { --sci: #A5F3FC; --art: #FBCFE8; --aurora: linear-gradient(45deg, #E0F2FE, #C084FC, #A5F3FC, #67E8F9); --gold: #FACC15; }
        * { box-sizing: border-box; font-family: "PingFang TC", "Noto Sans TC", sans-serif; transition: all 0.3s ease; }
        body { margin: 0; background: #F8FAFC; color: #1E293B; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* é˜²å¼Šç´…è‰²è­¦å ± */
        #cheat-guard { position: fixed; inset: 0; background: #EF4444; z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }

        /* å…¥å£å¤§é–€ */
        #entrance { position: fixed; inset: 0; background: white; z-index: 9000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .door { width: 150px; height: 250px; background: #D97706; border: 5px solid #92400E; border-radius: 8px; cursor: pointer; position: relative; }
        .door::after { content: 'æ•²æ•²é–€'; position: absolute; top: -40px; width: 100%; text-align: center; color: #92400E; font-weight: bold; }

        header { padding: 15px 20px; background: white; border-bottom: 1px solid #E2E8F0; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .timer-tag { font-family: monospace; font-size: 1.5rem; color: #0891B2; background: #ECFEFF; padding: 5px 20px; border-radius: 50px; border: 2px solid #A5F3FC; box-shadow: 0 0 15px rgba(165,243,252,0.5); }
        .stat-pill { background: #F1F5F9; padding: 6px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; display: flex; align-items: center; gap: 5px; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        
        /* å°‘å¥³èˆ‡æ¥µå…‰è£™ */
        .character-box { position: relative; width: 280px; height: 400px; }
        .teacher-img { width: 100%; height: 100%; object-fit: contain; z-index: 2; position: relative; }
        .aurora-bg { position: absolute; inset: -20px; background: var(--aurora); opacity: 0; filter: blur(50px); transition: 2s; z-index: 1; border-radius: 50%; }
        .active-aurora { opacity: 0.6; animation: aurora-move 6s infinite alternate; }
        @keyframes aurora-move { 0% { transform: scale(1) rotate(0deg); } 100% { transform: scale(1.2) rotate(10deg); } }

        .talk-bubble { background: white; padding: 15px 25px; border-radius: 25px; max-width: 450px; text-align: center; margin-bottom: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #F1F5F9; font-weight: 500; }

        /* é¡Œç›®å¡ç‰‡ */
        .quiz-card { background: white; padding: 30px; border-radius: 35px; width: 100%; max-width: 550px; box-shadow: 0 25px 60px rgba(0,0,0,0.1); border: 1px solid #E2E8F0; text-align: center; }
        .opt-btn { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #F1F5F9; border-radius: 18px; background: white; cursor: pointer; text-align: left; font-size: 1rem; font-weight: 600; }
        .opt-btn:hover { border-color: #A5F3FC; background: #F0FDFF; transform: translateX(5px); }
        
        .energy-mode { color: #16A34A; border: 2px solid #16A34A !important; }

        nav { background: white; border-top: 1px solid #E2E8F0; display: flex; padding: 10px; gap: 10px; }
        .nav-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; background: #F8FAFC; color: #64748B; font-weight: bold; cursor: pointer; }
        .nav-btn.active { background: #ECFEFF; color: #0891B2; box-shadow: inset 0 0 0 2px #A5F3FC; }
    </style>
</head>
<body>

<div id="cheat-guard">
    <h1>ğŸš« ç¦æ­¢è·³è½‰ï¼</h1>
    <p>æ±Ÿéˆ´ï¼šèª å¯¦æ˜¯å­¸ç¿’çš„ç¬¬ä¸€æ­¥ã€‚å¦³é›¢é–‹äº†é é¢ï¼Œé«”åŠ›å·²æ‰£é™¤ã€‚</p>
    <button onclick="location.reload()" style="padding:10px 30px; border-radius:15px; border:none; cursor:pointer;">é‡æ–°é€²å…¥ç³»çµ±</button>
</div>

<div id="entrance" onclick="this.style.transform='translateY(-100%)'">
    <h2 style="margin-bottom:40px; color:#475569;">æ±Ÿå®¶å§Šå¦¹ï¼šéŠ€ç™½è‰²çš„æ™ºæ…§å®¶åœ’</h2>
    <div class="door"></div>
    <p style="margin-top:30px; color:#94A3B8;">é»æ“Šå¤§é–€ï¼Œé–‹å§‹ä»Šæ—¥çš„ä¿®ç…‰</p>
</div>

<header>
    <div id="timer-ui" class="timer-tag">03:00</div>
    <div style="display:flex; gap:10px;">
        <div class="stat-pill">âš¡ <span id="u-e">100</span>%</div>
        <div class="stat-pill">ğŸª™ <span id="u-c">0</span></div>
    </div>
</header>

<main>
    <div id="talk" class="talk-bubble">ä½ å¥½ï¼æˆ‘æ˜¯æ±Ÿéˆ´ã€‚ä»Šå¤©çš„å­¸ç¿’ç›®æ¨™æ˜¯ä»€éº¼å‘¢ï¼Ÿ</div>
    <div class="character-box">
        <div id="aurora" class="aurora-bg"></div>
        <img id="img-sci" class="teacher-img" src="IMG_3812.jpeg"> <img id="img-art" class="teacher-img" src="IMG_4392.jpg" style="display:none;"> </div>

    <div class="quiz-card" id="quiz-ui">
        <h2 id="q-text" style="margin-bottom:25px;">æº–å‚™å¥½æ¥å—æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
        <div id="options-box">
            <button class="opt-btn" onclick="setGrade('primary')">ğŸ« å°å­¸ï¼šç”Ÿæ´»å¸¸è­˜ (tcool.cc)</button>
            <button class="opt-btn" onclick="setGrade('cap')">ğŸ“ åœ‹ä¸­ï¼šæœƒè€ƒç´ é¤Š (rcpet)</button>
            <button class="opt-btn" onclick="setGrade('gsat')">ğŸ§ª é«˜ä¸­ï¼šç‰©ç†å­¸æ¸¬ (CJHS)</button>
            <button class="opt-btn" onclick="setGrade('master')">ğŸŒŒ ç¢©åšï¼šå°ˆç ”æ¨¡å¼ (get.com.tw)</button>
        </div>
    </div>
</main>

<nav>
    <button id="btn-sci" class="nav-btn active" onclick="switchT('sci')">æ±Ÿéˆ´ (ç†ç§‘)</button>
    <button id="btn-art" class="nav-btn" onclick="switchT('art')">æ±Ÿä¾ (æ–‡ç§‘)</button>
    <button class="nav-btn" onclick="startRecovery()" style="background:#DCFCE7; color:#16A34A;">âš¡ è£œèƒ½é¡Œåº«</button>
</nav>

<script>
    let user = { e: 100, c: 0, level: 0, teacher: 'sci', mode: '' };
    let timer;

    function switchT(t) {
        user.teacher = t;
        document.getElementById('img-sci').style.display = t === 'sci' ? 'block' : 'none';
        document.getElementById('img-art').style.display = t === 'art' ? 'block' : 'none';
        document.getElementById('btn-sci').classList.toggle('active', t === 'sci');
        document.getElementById('btn-art').classList.toggle('active', t === 'art');
        document.getElementById('talk').innerText = t === 'sci' ? "æˆ‘æ˜¯æ±Ÿéˆ´ï¼Œç§‘å­¸çš„ä¸–ç•Œå¾ˆæº«æš–å–”ï¼" : "æˆ‘æ˜¯æ±Ÿä¾ï¼Œè®“æˆ‘å€‘åœ¨æ–‡å­—ä¸­æ¼«æ­¥å§ã€‚";
    }

    function setGrade(m) {
        user.mode = m;
        document.getElementById('q-text').innerText = "ç›®æ¨™é–å®šã€‚æº–å‚™é€²å…¥ 108 èª²ç¶±é›²ç«¯è€ƒå ´ã€‚";
        document.getElementById('options-box').innerHTML = `<button class="opt-btn" style="background:#0891B2; color:white; text-align:center;" onclick="startExam()">ç¢ºèªé€²å…¥ (æ¶ˆè€— 20âš¡)</button>`;
    }

    // --- è£œèƒ½æ¨¡å¼ ---
    function startRecovery() {
        document.getElementById('talk').innerText = "æ±Ÿéˆ´ï¼šç´¯äº†å—ï¼Ÿæˆ‘å€‘ä¾†ç©å€‹å°å•ç­”ï¼Œå¹«å¦³å›å¾©é«”åŠ›å§ï¼";
        document.getElementById('q-text').innerText = "ã€è£œèƒ½æ¨¡å¼ã€‘å¿«é€Ÿç­”å° 3 é¡Œå³å¯å›å¾© 20âš¡";
        renderQ("1+1=?", ["2", "3", "4"], 0, true);
    }

    // --- æ­£å¼è€ƒå ´é‚è¼¯ ---
    async function startExam() {
        if(user.e < 20) return alert("é«”åŠ›ä¸è¶³ï¼Œè«‹å…ˆå»è£œèƒ½æ¨¡å¼åˆ·é¡Œå–”ï¼");
        sessionStorage.setItem('EXAM_LOCK', 'true');
        
        let qCount = 0;
        let wrongs = 0;

        function next() {
            qCount++;
            if(qCount > 10) return finish(wrongs);
            
            // ç¢©åšä¸è¨ˆæ™‚ï¼Œå…¶ä»–æœ€ä½3åˆ†é˜
            if(user.mode !== 'master') startTimer(user.mode === 'primary' ? 3 : 5);
            else document.getElementById('timer-ui').innerText = "ğŸ† ç«¶è³½æ¨¡å¼";

            renderQ(`(108èª²ç¶±æ¨¡æ“¬) ç¬¬ ${qCount}/10 é¡Œï¼šé—œæ–¼è³‡æ–™åº«æŠ“å–...`, ["æ­£ç¢ºç­”æ¡ˆ", "èª˜ç­” A", "èª˜ç­” B"], 0);
        }

        window.handleAns = (isCorrect, isRecovery) => {
            if(isRecovery) {
                user.e = Math.min(100, user.e + 10);
                alert("é«”åŠ›å›å¾©æˆåŠŸï¼");
                updateUI();
                return location.reload();
            }
            if(!isCorrect) wrongs++;
            next();
        };

        next();
    }

    function renderQ(q, opts, correctIdx, isRec = false) {
        document.getElementById('q-text').innerText = q;
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        opts.forEach((txt, i) => {
            let b = document.createElement('button');
            b.className = isRec ? "opt-btn energy-mode" : "opt-btn";
            b.innerText = txt;
            b.onclick = () => handleAns(i === correctIdx, isRec);
            box.appendChild(b);
        });
    }

    function startTimer(m) {
        let sec = m * 60;
        clearInterval(timer);
        timer = setInterval(() => {
            let min = Math.floor(sec/60);
            let s = sec%60;
            document.getElementById('timer-ui').innerText = `${min}:${s < 10 ? '0' : ''}${s}`;
            if(sec <= 0) { clearInterval(timer); alert("æ™‚é–“åˆ°ï¼"); finish(10); }
            sec--;
        }, 1000);
    }

    function finish(wrongs) {
        clearInterval(timer);
        sessionStorage.removeItem('EXAM_LOCK');
        user.e -= 20;
        if(wrongs <= 3) {
            user.c += 500;
            user.level++;
            alert("å¦³å¤ªå²å®³äº†ï¼æ±Ÿéˆ´ç‚ºå¦³æ„Ÿåˆ°é©•å‚²ã€‚");
            if(user.level >= 3) document.getElementById('aurora').classList.add('active-aurora'); // æ¥µå…‰è£™è§¸ç™¼
        }
        updateUI();
        location.reload();
    }

    // --- é˜²å¼Šèˆ‡ UI æ›´æ–° ---
    document.addEventListener("visibilitychange", () => {
        if (document.hidden && sessionStorage.getItem('EXAM_LOCK')) {
            user.e = Math.max(0, user.e - 20);
            localStorage.setItem('jiang_final_save', JSON.stringify(user));
            document.getElementById('cheat-guard').style.display = 'flex';
        }
    });

    function updateUI() {
        document.getElementById('u-e').innerText = user.e;
        document.getElementById('u-c').innerText = user.c;
        localStorage.setItem('jiang_final_save', JSON.stringify(user));
    }

    window.onload = () => {
        const s = localStorage.getItem('jiang_final_save');
        if(s) user = JSON.parse(s);
        updateUI();
    };
</script>
</body>
</html>
