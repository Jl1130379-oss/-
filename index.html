<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±Ÿå®¶æ™ºæ…§åŸå¸‚</title>
    <style>
        :root { --main: #2c3e50; --gold: #d4af37; --bg: #f9f7f2; }
        * { box-sizing: border-box; font-family: "PingFang TC", sans-serif; transition: 0.3s; }
        body { margin: 0; background: #000; color: #333; height: 100vh; overflow: hidden; }

        /* èƒŒæ™¯ç•«é¢¨ä¾ç…§è€å¸«åˆç…§ */
        #world-bg {
            position: fixed; inset: 0;
            background: linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.2)), url('æ±Ÿè€å¸«åˆç…§èƒŒæ™¯.jpg');
            background-size: cover; background-position: center; z-index: -1;
        }

        /* å·¦å´å°èˆª */
        #sidebar {
            position: fixed; left: 0; top: 0; bottom: 0; width: 200px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(15px);
            display: flex; flex-direction: column; padding-top: 50px; z-index: 100;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }
        .nav-link {
            padding: 18px 25px; cursor: pointer; font-weight: bold; font-size: 0.95rem;
            color: var(--main); border-bottom: 1px solid #eee;
        }
        .nav-link:hover { background: var(--main); color: white; }

        /* ä¸»èˆå° */
        #stage { margin-left: 200px; height: 100vh; position: relative; }
        
        /* è€å¸«å‹•æ…‹æ°£æ³¡ */
        #teacher-bubble {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            background: white; padding: 20px 40px; border-radius: 50px;
            font-weight: bold; border: 2px solid var(--gold); display: none; z-index: 200;
        }

        /* é ‚éƒ¨è³‡è¨Š */
        .info-bar {
            position: absolute; top: 20px; right: 30px; 
            background: white; padding: 10px 25px; border-radius: 50px;
            font-weight: 900; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* ç­”é¡Œç³»çµ± */
        .quiz-container { display: none; text-align: left; }
        .timer { color: #e74c3c; font-size: 1.5rem; font-weight: 900; margin-bottom: 10px; }

        /* ç›¸ç°¿ Grid */
        .album-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .photo-card { border: 2px solid var(--gold); border-radius: 8px; height: 100px; background: #fff; }

        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-body { background: white; width: 600px; padding: 40px; border-radius: 30px; text-align: center; }
        .btn { padding: 10px 20px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; margin: 5px; font-weight: bold; }
        .btn:hover { background: var(--gold); color: white; }
    </style>
</head>
<body>

<div id="world-bg"></div>

<div id="sidebar">
    <div class="nav-link" onclick="openQuiz('science')">ğŸ§¬ ç†ç§‘æ•™ç ” (æ±Ÿéˆ´)</div>
    <div class="nav-link" onclick="openQuiz('arts')">ğŸ“œ æ–‡ç§‘å“é‘‘ (æ±Ÿä¾)</div>
    <div class="nav-link" onclick="enterYard()">ğŸ¡ æ±Ÿå®¶åº­é™¢</div>
    <div class="nav-link" onclick="openModal('shop')">ğŸ›’ åŸå¸‚å•†å ´</div>
    <div class="nav-link" onclick="openModal('closet')">ğŸ‘— ç§äººæ›´è¡£å®¤</div>
    <div class="nav-link" onclick="openModal('album')">ğŸ“¸ æ±Ÿè€å¸«ç›¸ç°¿</div>
</div>

<div id="stage">
    <div class="info-bar">ğŸª™ <span id="coin-val">500</span></div>
    <div id="teacher-bubble"></div>
    
    <button id="snap-btn" style="display:none; position:absolute; bottom:50px; right:50px; font-size:40px; background:none; border:none; cursor:pointer;" onclick="snapPhoto()">ğŸ“¸</button>
</div>

<div onclick="admin()" style="position:fixed; top:15px; left:15px; font-size:40px; opacity:0.2; cursor:pointer; z-index:200;">â„ï¸</div>

<div id="modal" class="modal" onclick="closeModal()">
    <div class="modal-body" onclick="event.stopPropagation()">
        <h2 id="m-title"></h2>
        <div id="m-content"></div>
        <button class="btn" onclick="closeModal()" style="margin-top:20px;">é›¢é–‹</button>
    </div>
</div>

<script>
    let state = { coins: 500, isAdmin: false, album: [], timer: null };

    const quizData = {
        science: [
            { lv: 'å…¥é–€', q: 'äººé«”è¡€æ¶²ä¸­è² è²¬é‹è¼¸æ°§æ°£çš„æ˜¯ï¼Ÿ', a: ['ç´…è¡€çƒ', 'ç™½è¡€çƒ'], r: 0, reward: 100, time: 20 },
            { lv: 'é€²éš', q: 'é—œæ–¼DNAé›™èºæ—‹çµæ§‹ï¼Œå“ªå°é¹¼åŸºæ˜¯äº’ç›¸é…å°çš„ï¼Ÿ', a: ['A-T', 'A-C'], r: 0, reward: 300, time: 15 },
            { lv: 'å°ˆå®¶', q: 'ä¸‹åˆ—ä½•ç¨®æ¿€ç´ ä¸»è¦ç”±ç”²ç‹€è…ºåˆ†æ³Œï¼Ÿ', a: ['ç”²ç‹€è…ºç´ ', 'èƒ°å³¶ç´ ', 'è…ä¸Šè…ºç´ '], r: 0, reward: 800, time: 10 }
        ],
        arts: [
            { lv: 'å…¥é–€', q: 'ã€Šç´…æ¨“å¤¢ã€‹çš„ä½œè€…æ™®éèªç‚ºæ˜¯ï¼Ÿ', a: ['æ›¹é›ªèŠ¹', 'ç¾…è²«ä¸­'], r: 0, reward: 100, time: 20 },
            { lv: 'å°ˆå®¶', q: 'ã€Œè½éœèˆ‡å­¤é¶©é½Šé£›ã€ä¸‹ä¸€å¥æ˜¯ï¼Ÿ', a: ['ç§‹æ°´å…±é•·å¤©ä¸€è‰²', 'é•·æ±Ÿä¹‹æ°´å¤©ä¸Šä¾†'], r: 0, reward: 800, time: 10 }
        ]
    };

    function talk(msg) {
        const b = document.getElementById('teacher-bubble');
        b.innerText = msg;
        b.style.display = 'block';
        setTimeout(() => b.style.display = 'none', 4000);
    }

    function openQuiz(type) {
        const qList = quizData[type];
        const q = qList[Math.floor(Math.random() * qList.length)];
        const title = type === 'science' ? 'æ±Ÿéˆ´çš„ç†ç§‘æ•™å®¤' : 'æ±Ÿä¾çš„æ–‡ç§‘æ²™é¾';
        
        document.getElementById('m-title').innerText = `${title} [${q.lv}]`;
        let optionsHtml = q.a.map((opt, i) => `<button class="btn" onclick="checkAnswer(${i}, ${q.r}, ${q.reward})">${opt}</button>`).join('');
        
        document.getElementById('m-content').innerHTML = `
            <div class="timer" id="t-clock">å‰©é¤˜æ™‚é–“: ${q.time}s</div>
            <p style="font-size:1.2rem; font-weight:bold;">${q.q}</p>
            ${optionsHtml}
        `;
        
        openModal('custom');
        startTimer(q.time);
    }

    function startTimer(sec) {
        clearInterval(state.timer);
        let left = sec;
        state.timer = setInterval(() => {
            left--;
            document.getElementById('t-clock').innerText = `å‰©é¤˜æ™‚é–“: ${left}s`;
            if(left <= 0) {
                clearInterval(state.timer);
                alert("æ±Ÿéˆ´ï¼šæ™‚é–“åˆ°å›‰ï¼Œæ€è€ƒè¦å†æœæ–·ä¸€é»ï¼");
                closeModal();
            }
        }, 1000);
    }

    function checkAnswer(idx, right, reward) {
        clearInterval(state.timer);
        if(idx === right) {
            state.coins += reward;
            updateUI();
            talk(`è€å¸«ï¼šç­”å°äº†ï¼é€™ä»½çå‹µå¦³æ‡‰å¾—çš„ (ğŸª™${reward})`);
        } else {
            talk("è€å¸«ï¼šå“å‘€ï¼Œå·®ä¸€é»é»ï¼Œä¸‹æ¬¡è¦æ›´ç´°å¿ƒå–”ã€‚");
        }
        closeModal();
    }

    function enterYard() {
        document.getElementById('snap-btn').style.display = 'block';
        talk("æ±Ÿä¾ï¼šåº­é™¢çš„é™½å…‰æ­£å¥½ï¼Œé©åˆç•™ä¸‹å”¯ç¾çš„ç¬é–“ã€‚");
    }

    function snapPhoto() {
        const id = state.album.length + 1;
        state.album.push(`å”¯ç¾åˆå½± #${id}`);
        alert("ğŸ“¸ å–€æ“¦ï¼æ•æ‰åˆ°è€å¸«æœ€ç¾çš„ä¸€é¢ï¼Œå·²å­˜å…¥ç›¸ç°¿ã€‚");
    }

    function openModal(type) {
        if(type !== 'custom') {
            document.getElementById('m-title').innerText = 
                type === 'shop' ? 'æ±Ÿå®¶å•†å ´' : 
                type === 'closet' ? 'æ›´è¡£å®¤' : 'æ±Ÿè€å¸«ç›¸ç°¿';
            
            let content = "";
            if(type === 'shop') {
                let p = state.isAdmin ? 100 : 1000;
                content = `<p>å¤§ç†çŸ³é•·æ¤… - ğŸ’°${p} <button onclick="buy(${p})">è³¼è²·</button></p>`;
            } else if(type === 'album') {
                content = `<div class="album-grid">${state.album.map(p => `<div class="photo-card">${p}</div>`).join('')}</div>`;
                if(state.album.length === 0) content = "ç›¸ç°¿ç©ºç©ºçš„ï¼Œå»åº­é™¢æ‹ç…§å§ï¼";
            }
            document.getElementById('m-content').innerHTML = content;
        }
        document.getElementById('modal').style.display = 'flex';
    }

    function buy(p) {
        if(state.coins >= p) {
            state.coins -= p;
            updateUI();
            alert("æ±Ÿä¾ï¼šé€™ä»¶å®¶å…·è®“å®¶è£¡æ›´æº«é¦¨äº†ã€‚");
        } else alert("éŒ¢å¹£ä¸è¶³ï¼Œå¿«å»æŒ‘æˆ°é¡Œç›®å§ï¼");
    }

    function admin() {
        if(prompt("æœ€é«˜ç®¡ç†è€…ä»£ç¢¼ï¼š") === "æ±Ÿæ†¶å©·") {
            state.isAdmin = true;
            state.coins += 1000;
            updateUI();
            alert("ğŸ‘‘ æ­¡è¿ç®¡ç†è€…æ±Ÿæ†¶å©·ï¼å•Ÿå‹•é‡‘å·²ç™¼æ”¾ï¼Œå•†å ´ç‰¹æ¬Šå·²é–‹å•Ÿã€‚");
        }
    }

    function updateUI() { document.getElementById('coin-val').innerText = (state.isAdmin ? "â„ï¸ " : "") + state.coins; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; clearInterval(state.timer); }
</script>
</body>
</html>
