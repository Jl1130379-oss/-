<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå®¶å§Šå¦¹é›²ç«¯æ•™å®¤</title>
    <style>
        :root { --sci: #4FC3F7; --art: #9575CD; --dark: #263238; }
        * { box-sizing: border-box; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; height: 100vh; background: #f4f9fc; display: flex; flex-direction: column; overflow: hidden; }

        header { background: var(--dark); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        #sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 260px; background: #212121; color: white; transform: translateX(-100%); transition: 0.3s; z-index: 150; padding-top: 60px; }
        #sidebar.open { transform: translateX(0); }
        .menu-item { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .avatar-box { width: 220px; height: 220px; position: relative; margin-bottom: 20px; }
        .t-img { width: 100%; height: 100%; border-radius: 50%; border: 6px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); object-fit: cover; display: none; animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .bubble { background: white; padding: 15px 20px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 320px; text-align: center; font-size: 1.1rem; }
        .card { background: white; padding: 25px; border-radius: 30px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        .btn { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #eee; border-radius: 15px; background: white; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .btn:active { background: #f0faff; transform: scale(0.98); }
    </style>
</head>
<body>

<header>
    <button class="btn" style="width:auto; margin:0; padding:5px 15px;" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜° èª²ç¨‹é¸å–®</button>
    <span style="font-weight:bold;">æ±Ÿå®¶å§Šå¦¹ï¼šé†«é“èˆ‡æ–‡å¿ƒ</span>
    <div style="width:50px;"></div>
</header>

<div id="sidebar">
    <div id="course-list"></div>
</div>

<main>
    <div id="talk" class="bubble">æ­¡è¿ä¾†åˆ°æ•™å®¤ï¼</div>
    <div class="avatar-box">
        <img id="img-sci" class="t-img" src="./IMG_3812.jpeg">
        <img id="img-art" class="t-img" src="./IMG_4392.jpg">
    </div>

    <div id="quiz-area" class="card">
        <h2 id="q-text">æ±Ÿéˆ´è€å¸«æ­£åœ¨ç­‰å¦³ï¼Œæº–å‚™å¥½äº†å—ï¼Ÿ</h2>
        <div id="options">
            <button class="btn" onclick="startFirstCourse()">æº–å‚™å¥½äº†</button>
            <button class="btn" onclick="alert('æ²’é—œä¿‚ï¼Œä¼‘æ¯ä¸€ä¸‹å†å›ä¾†ï¼')">é‚„æƒ³å†ç©ä¸€ä¸‹ä¸‹</button>
        </div>
    </div>
</main>

<script>
    // --- é€™è£¡å°±æ˜¯ã€Œå¯«é€²å»ã€çš„èª²ç¨‹å…§å®¹å‚™ä»½ ---
    let database = [
        ["sci", "é†«å­¸é‚è¼¯å…¥é–€", "å¦‚æœç—…æ‚£æ„Ÿåˆ°é ­ç—›ä¸”ç™¼ç‡’ï¼Œç¬¬ä¸€æ­¥æ‡‰è©²ï¼Ÿ", "æ¸¬é‡é«”æº«", "ç«‹åˆ»é–‹å¼·æ•ˆè—¥", "0"],
        ["art", "æ–‡å­¸ä¹‹ç¾", "ã€åºŠå‰æ˜æœˆå…‰ã€çš„ä¸‹ä¸€å¥æ˜¯ï¼Ÿ", "ç–‘æ˜¯åœ°ä¸Šéœœ", "èˆ‰é ­æœ›æ˜æœˆ", "0"],
        ["sci", "é˜²ç–«å°å¸¸è­˜", "æ­£ç¢ºçš„æ´—æ‰‹æ™‚é–“æ‡‰è‡³å°‘æŒçºŒå¹¾ç§’ï¼Ÿ", "5ç§’", "20ç§’", "1"]
    ];

    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTUgIoeIVP3h4C7hoHlAN7gtg_r0AYPMlX5CewmhSMCmE5faKjYD_a--Jo8u3uRmRlS2x6TzgTkvfj4/pub?output=csv";

    // åˆå§‹åŒ–ï¼šå…ˆè®€å–å…§ç½®èª²ç¨‹ï¼Œå†å˜—è©¦åŒæ­¥é›²ç«¯
    function init() {
        renderSidebar();
        syncWithCloud();
    }

    async function syncWithCloud() {
        try {
            const res = await fetch(CSV_URL + '&t=' + Date.now());
            const text = await res.text();
            const rows = text.split("\n").filter(r => r.trim() !== "").map(r => r.split(","));
            if(rows.length > 1) {
                database = rows.slice(1); // ç”¨é›²ç«¯è³‡æ–™æ›¿æ›å…§ç½®è³‡æ–™
                renderSidebar();
            }
        } catch (e) {
            console.log("é›²ç«¯é€£ç·šå¤±æ•—ï¼Œä½¿ç”¨å…§ç½®å‚™ä»½èª²ç¨‹ã€‚");
        }
    }

    function renderSidebar() {
        const list = document.getElementById('course-list');
        list.innerHTML = "";
        database.forEach((row, i) => {
            let d = document.createElement('div');
            d.className = "menu-item";
            d.innerText = "ğŸ“– " + row[1];
            d.onclick = () => { loadQuiz(i); document.getElementById('sidebar').classList.remove('open'); };
            list.appendChild(d);
        });
    }

    function startFirstCourse() {
        loadQuiz(0);
    }

    function loadQuiz(idx) {
        const row = database[idx];
        const type = row[0].trim().toLowerCase();
        
        document.getElementById('img-sci').style.display = (type === 'sci') ? 'block' : 'none';
        document.getElementById('img-art').style.display = (type === 'art') ? 'block' : 'none';

        document.getElementById('talk').innerText = (type === 'sci') ? "æˆ‘æ˜¯æ±Ÿéˆ´ï¼Œæº–å‚™å¥½æ¥å—é†«å­¸æŒ‘æˆ°äº†å—ï¼Ÿ" : "æˆ‘æ˜¯æ±Ÿä¾ï¼Œè®“æˆ‘å€‘é€²å…¥åœ‹å­¸çš„ä¸–ç•Œã€‚";
        document.getElementById('q-text').innerText = row[2];

        const box = document.getElementById('options');
        box.innerHTML = "";
        [row[3], row[4]].forEach((txt, i) => {
            let b = document.createElement('button');
            b.className = "btn";
            b.innerText = txt;
            b.onclick = () => {
                if(i == row[5].trim()) {
                    document.getElementById('talk').innerText = "ğŸŒŸ ç­”å°äº†ï¼å¤ªå²å®³äº†ã€‚";
                    speak("ç­”å°äº†ï¼");
                } else {
                    document.getElementById('talk').innerText = "å“å‘€ï¼Œå†æƒ³ä¸€ä¸‹ï¼Ÿ";
                    speak("å†æƒ³ä¸€ä¸‹ï¼Ÿ");
                }
            };
            box.appendChild(b);
        });
        speak(document.getElementById('talk').innerText);
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'zh-TW';
        window.speechSynthesis.speak(u);
    }

    init();
</script>
</body>
</html>
