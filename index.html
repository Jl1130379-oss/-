<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ±Ÿå®¶æ™ºæ…§åŸå¸‚ | äº”éšæ¼”é€²ç³»çµ±</title>
    <style>
        :root { --blue: #00f2fe; --pink: #ff00de; --gold: #ffd700; --bg: #010205; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'PingFang TC', sans-serif; overflow: hidden; }
        .viewport { width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        
        /* HUD é ‚éƒ¨é¢æ¿ */
        .hud { display: flex; justify-content: space-between; padding: 20px 45px; background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--blue); }
        .stat-item { font-size: 1.1rem; font-weight: bold; text-shadow: 0 0 10px var(--blue); }

        /* å°å¸«ç”Ÿå‘½è‰™ */
        .stage { display: flex; justify-content: center; align-items: center; gap: 90px; flex: 1; }
        .avatar-pod { text-align: center; cursor: pointer; transition: 0.5s ease; position: relative; }
        .avatar-circle { 
            width: 230px; height: 230px; border-radius: 50%; border: 4px solid var(--blue);
            background-size: cover; background-position: center; box-shadow: 0 0 30px rgba(0, 242, 254, 0.2);
        }
        
        /* é–å®šé‚è¼¯ï¼šä¸­é€”ä¸å¯æ›äºº */
        .forbidden { filter: grayscale(1) brightness(0.15) blur(1px); opacity: 0.3; pointer-events: none; transform: scale(0.85); }

        /* æ™ºæ…§æ•™å­¸é¢æ¿ */
        .edu-overlay {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 88%; max-width: 1000px; background: rgba(5, 10, 20, 0.98);
            border: 2px solid var(--gold); border-radius: 40px; padding: 35px;
            display: none; z-index: 1000; box-shadow: 0 0 60px #000;
        }
        .timer-ui { float: right; font-size: 2.2rem; color: var(--pink); font-family: 'Courier New', monospace; }
        .btn { padding: 15px 45px; border-radius: 50px; border: 1px solid var(--blue); background: transparent; color: #fff; cursor: pointer; font-weight: bold; transition: 0.3s; margin: 5px; }
        .btn:hover:not(:disabled) { background: var(--blue); color: #000; box-shadow: 0 0 20px var(--blue); }
    </style>
</head>
<body>

<div class="viewport">
    <div class="hud">
        <div class="stat-item" style="color:var(--gold)"><i class="fas fa-coins"></i> æ˜ç‡ˆ: <span id="coin-ui">0</span></div>
        <div id="status-msg" class="stat-item">ğŸ® æ­¡è¿å›åˆ°æ™ºæ…§åŸå¸‚</div>
        <div class="stat-item" style="color:var(--pink)"><i class="fas fa-heart"></i> HP: <span id="hp-ui">100</span></div>
    </div>

    <div class="stage">
        <div class="avatar-pod" id="pod-ling" onclick="selectTeacher('ling')">
            <div class="avatar-circle" style="background-image: url('https://i.imgur.com/KzDqMhH.png');"></div>
            <h3 style="color:var(--blue)">æ±Ÿéˆ´ (ç†ç§‘)</h3>
            <div style="font-size:0.8rem; color:var(--gold)">ğŸ‘— æµå‹•æ¥µå…‰è£™</div>
        </div>
        <div class="avatar-pod" id="pod-yi" onclick="selectTeacher('yi')">
            <div class="avatar-circle" style="background-image: url('https://i.imgur.com/vH0I1Gj.png'); border-color:var(--pink)"></div>
            <h3 style="color:var(--pink)">æ±Ÿä¾ (æ–‡ç§‘)</h3>
            <div style="font-size:0.8rem; color:var(--gold)">ğŸ‘˜ è½æ«»ç¹½ç´›æ¼¢æœ</div>
        </div>
    </div>

    <div class="edu-overlay" id="edu-panel">
        <div id="timer-val" class="timer-ui"></div>
        <h2 id="topic-name" style="color:var(--gold)"></h2>
        <div id="teaching-text" style="font-size:1.2rem; line-height:1.8; margin:25px 0;"></div>
        <div id="option-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;"></div>
        <div id="footer-ctrl" style="text-align:center; margin-top:20px;"></div>
    </div>

    <div style="text-align:center; padding-bottom: 40px;">
        <button id="load-btn" class="btn" style="border-color:var(--gold); color:var(--gold)" onclick="triggerCourse()">âš¡ è‡ªå‹•åŠ èª² (5éšé›£åº¦)</button>
        <button class="btn" onclick="exchange()">è§£é–å‹•ä½œ (æ­¸é›¶)</button>
    </div>
</div>

<script>
    let state = { coin: 0, hp: 100, mode: 'idle', level: '', teacher: '', currentQ: null, timer: null };

    // 5 é›£åº¦ç­‰ç´šè¨­å®š
    const DIFFICULTY_MAP = {
        'åœ‹å°': { time: 180, reward: 0.1, penalty: 2 },
        'åœ‹ä¸­': { time: 60,  reward: 0.5, penalty: 5 },
        'é«˜ä¸­': { time: 30,  reward: 1.0, penalty: 10 },
        'å¤§å­¸': { time: 0,   reward: 2.5, penalty: 20 },
        'ç¢©åš': { time: 0,   reward: 5.0, penalty: 40 }
    };

    // æ¨¡æ“¬è‡ªå‹•æŠ“é¡Œ (åŒä¸»é¡Œç•°æ·±åº¦)
    const DynamicCloud = {
        async fetch() {
            return { topic: "é‡å­åŠ›å­¸ï¼šæ¸¬ä¸æº–åŸç†" };
        },
        getContent(topic, level, teacher) {
            const contents = {
                'åœ‹å°': `å°å¸«ï¼šã€å°±åƒå¦³åœ¨æ‹ä¸€å€‹å¾ˆå¿«çš„çƒï¼Œå¦³æ‹åˆ°å®ƒçš„æ™‚å€™ï¼Œå®ƒå°±å·²ç¶“ä¸åœ¨åŸæœ¬çš„ä½ç½®äº†ã€‚ã€`,
                'åœ‹ä¸­': `å°å¸«ï¼šã€æµ·æ£®å ¡ç™¼ç¾ï¼Œå¾®è§€ç²’å­çš„ä½ç½®å’Œå‹•é‡ç„¡æ³•åŒæ™‚è¢«ç²¾ç¢ºæ¸¬é‡ã€‚ã€`,
                'é«˜ä¸­': `å°å¸«ï¼šã€é€™ä¸æ˜¯æ¸¬é‡æŠ€è¡“å•é¡Œï¼Œè€Œæ˜¯æ³¢åŒ…å¡Œç¸®çš„å¿…ç„¶ã€‚$\Delta x \Delta p \geq \frac{h}{4\pi}$ã€‚ã€`,
                'å¤§å­¸': `å°å¸«ï¼šã€ç®—ç¬¦éå°æ˜“æ€§ $[x, p] = i\hbar$ æ±ºå®šäº†ç‰©ç†é‡çš„æ¨™æº–å·®ä¹˜ç©ä¸‹é™ã€‚ã€`,
                'ç¢©åš': `å°å¸«ï¼šã€æ¢è¨å¸Œçˆ¾ä¼¯ç‰¹ç©ºé–“ä¸­çš„ç›¸å¹²æ…‹æ¼”åŒ–ã€‚é€™åæ˜ äº†é‡å­åŠ›å­¸ä¸­ç›¸ç©ºé–“èˆ‡è³‡è¨Šç†µçš„æ·±å±¤è¯ç¹«...ã€`
            };
            return contents[level];
        }
    };

    async function triggerCourse() {
        if(state.mode !== 'idle') return;
        const levels = Object.keys(DIFFICULTY_MAP);
        state.level = prompt(`è«‹è¼¸å…¥é›£åº¦ç´šåˆ¥ï¼š\n${levels.join(' / ')}`, 'å¤§å­¸');
        if(!DIFFICULTY_MAP[state.level]) return;

        state.currentQ = await DynamicCloud.fetch();
        document.getElementById('edu-panel').style.display = 'block';
        document.getElementById('topic-name').innerText = `èª²é¡Œï¼š${state.currentQ.topic} [${state.level}]`;
        document.getElementById('teaching-text').innerText = "è«‹é¸å®šä¸€ä½å°å¸«æˆèª²ã€‚ä¸€æ—¦é–‹å§‹ï¼Œä¸­é€”ä¸å¯æ›èª²ã€‚";
        document.getElementById('status-msg').innerText = "ğŸ“ ç­‰å¾…å°å¸«é€²å…¥...";
    }

    function selectTeacher(t) {
        if(state.mode !== 'idle' || !state.level) return;
        state.mode = 'learning';
        state.teacher = t;

        // é–å®šå¦ä¸€ä½è€å¸«
        const other = t === 'ling' ? 'pod-yi' : 'pod-ling';
        document.getElementById(other).classList.add('forbidden');

        const content = DynamicCloud.getContent(state.currentQ.topic, state.level, t);
        document.getElementById('teaching-text').innerText = content;
        document.getElementById('footer-ctrl').innerHTML = `<button class="btn" onclick="startExam()">é ˜æ‚Ÿå®Œç•¢ï¼Œæ¥å—è€ƒé©—</button>`;
    }

    function startExam() {
        state.mode = 'exam';
        const config = DIFFICULTY_MAP[state.level];
        document.getElementById('teaching-text').innerText = `ã€è€ƒé©—ã€‘é›£åº¦ [${state.level}]ï¼šæ¸¬ä¸æº–åŸç†èªªæ˜äº†ä»€éº¼ï¼Ÿ`;
        
        // æ¸²æŸ“é¸é …
        const opts = ["ä½ç½®èˆ‡å‹•é‡çš„æ¬Šè¡¡", "æŠ€è¡“ç²¾ç¢ºåº¦ä¸å¤ ", "æ™‚é–“åœæ­¢äº†"];
        document.getElementById('option-grid').innerHTML = opts.map(o => 
            `<button class="btn" style="width:100%" onclick="submit('${o}')">${o}</button>`
        ).join('');

        // æ™‚é–“è™•ç†
        if(config.time > 0) {
            let s = config.time;
            state.timer = setInterval(() => {
                s--;
                document.getElementById('timer-val').innerText = `${s}s`;
                if(s <= 0) submit('');
            }, 1000);
        } else {
            document.getElementById('timer-val').innerText = "âˆ ç ”è¨";
        }
    }

    function submit(ans) {
        clearInterval(state.timer);
        const isCorrect = ans === "ä½ç½®èˆ‡å‹•é‡çš„æ¬Šè¡¡";
        const config = DIFFICULTY_MAP[state.level];

        if(isCorrect) {
            const gain = Math.floor(1000 * config.reward);
            state.coin += gain;
            alert(`æ­£ç¢ºï¼ç²å¾— ${gain} ç›æ˜ç‡ˆã€‚`);
        } else {
            state.hp -= config.penalty;
            alert(`éŒ¯èª¤ï¼æ±Ÿè€å¸«å°å¦³çš„é‚è¼¯æ„Ÿåˆ°ä¸æ‚…ã€‚`);
        }
        
        resetAll();
    }

    function resetAll() {
        state.mode = 'idle'; state.level = '';
        document.getElementById('edu-panel').style.display = 'none';
        document.getElementById('pod-ling').classList.remove('forbidden');
        document.getElementById('pod-yi').classList.remove('forbidden');
        document.getElementById('timer-val').innerText = "";
        updateUI();
    }

    function exchange() {
        if(state.coin <= 0) return alert("æ˜ç‡ˆä¸è¶³ä»¥æ¼”åŒ–ï¼");
        state.coin = 0; // å…Œæ›æ­¸é›¶
        alert("å‹•ä½œè§£é–ï¼æ˜ç‡ˆå·²å…¨æ•¸ç‡ƒç›¡ã€‚");
        updateUI();
    }

    function updateUI() {
        document.getElementById('coin-ui').innerText = state.coin;
        document.getElementById('hp-ui').innerText = state.hp;
    }
</script>
</body>
</html>
